(function(a,w,B,x){function t(b,d){this.element=b;this.options=a.extend({},u,d);this._defaults=u;this._name="photosetGrid";this.init()}var u={width:"100%",gutter:"0px",highresLinks:!1,lowresWidth:500,rel:"",borderActive:!1,borderWidth:"5px",borderColor:"#000000",borderRadius:"0",borderRemoveDouble:!1,onInit:function(){},onComplete:function(){}};t.prototype={init:function(){this.options.onInit();this._setupRows(this.element,this.options);this._setupColumns(this.element,this.options)},_callback:function(a){this.options.onComplete(a)},
_setupRows:function(b,d){if(d.layout)this.layout=d.layout;else if(a(b).attr("data-layout"))this.layout=a(b).attr("data-layout");else{for(var h="",f=0;f<a(b).find("img").length;f++)h+=(1).toString();this.layout=h}this.rows=this.layout.split("");for(var g in this.rows)this.rows[g]=parseInt(this.rows[g],10);var e=a(b).find("img"),q=0;a.each(this.rows,function(a,b){var d=q+b;e.slice(q,d).wrapAll('<div class="photoset-row cols-'+b+'"></div>');q=d});a(b).find(".photoset-row:not(:last-child)").css({"margin-bottom":d.gutter})},
_setupColumns:function(b,d){var h=this,f=function(e){function g(){var c=a(b).width().toString();c!==a(b).attr("data-width")&&(h.each(function(){var b=a(this).find("img:eq(0)");a(this).find("img").each(function(){var c=a(this);c.attr("height")<b.attr("height")&&(b=a(this));parseInt(c.css("width"),10)>d.lowresWidth&&c.attr("data-highres")&&c.attr("src",c.attr("data-highres"))});var c=b.attr("height")*parseInt(b.css("width"),10)/b.attr("width"),e=Math.floor(.025*c);a(this).height(c-e);d.borderActive&&
a(this).find(".photoset-content-border").each(function(){a(this).css({height:c-e})});a(this).find("img").each(function(){var b=a(this).attr("height")*parseInt(a(this).css("width"),10)/a(this).attr("width"),b=.5*(c-b)+"px";a(this).css({"margin-top":b})})}),a(b).attr("data-width",c))}var h=a(b).find(".photoset-row"),f=a(b).find("img");d.highresLinks?(f.each(function(){var b;b=a(this).attr("title")?' title="'+a(this).attr("title")+'"':"";var c;c=a(this).attr("data-highres")?a(this).attr("data-highres"):
a(this).attr("src");a(this).wrapAll('<a href="'+c+'"'+b+' class="photoset-cell highres-link" />');d.borderActive&&a(this).wrapAll('<span class="photoset-content-border" />')}),d.rel&&f.parent().attr("rel",d.rel)):f.each(function(){d.borderActive?(a(this).wrapAll('<div class="photoset-cell photoset-cell--border" />'),a(this).wrapAll('<div class="photoset-content-border" />')):a(this).wrapAll('<div class="photoset-cell" />')});var p=a(b).find(".photoset-cell"),y=a(b).find(".cols-1 .photoset-cell"),
c=a(b).find(".cols-2 .photoset-cell"),l=a(b).find(".cols-3 .photoset-cell"),z=a(b).find(".cols-4 .photoset-cell"),k=a(b).find(".cols-5 .photoset-cell"),m=a(b).find(".photoset-content-border");a(b).css({width:d.width});h.css({clear:"left",display:"block",overflow:"hidden"});p.css({"float":"left",display:"block","line-height":"0","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"});f.css({width:"100%",height:"auto"});d.borderActive&&m.css({display:"block",border:d.borderWidth+
" solid "+d.borderColor,"border-radius":d.borderRadius,overflow:"hidden","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"});e&&f.each(function(){a(this).attr("height",a(this).height());a(this).attr("width",a(this).width())});y.css({width:"100%"});c.css({width:"50%"});l.css({width:"33.3%"});z.css({width:"25%"});k.css({width:"20%"});e=parseInt(d.gutter,10);a(b).find(".photoset-cell:not(:last-child)").css({"padding-right":e/2+"px"});a(b).find(".photoset-cell:not(:first-child)").css({"padding-left":e/
2+"px"});d.borderRemoveDouble&&(a(b).find(".photoset-row").not(":eq(0)").find(".photoset-content-border").css({"border-top":"none"}),a(b).find(".photoset-row").not(".cols-1").find(".photoset-content-border").not(":eq(0)").css({"border-left":"none"}));g();a(w).on("resize",function(){g()})},g=!0,e=!0;a(b).find("img").each(function(){e=e&!!a(this).attr("height")&!!a(this).attr("width")});(g=!e)?a(b).imagesLoaded(function(){f(g);h._callback(b)}):(f(g),h._callback(b))}};a.fn.photosetGrid=function(b){return this.each(function(){a.data(this,
"plugin_photosetGrid")||a.data(this,"plugin_photosetGrid",new t(this,b))})};a.fn.imagesLoaded=function(b){function d(){var d=a(m),c=a(p);e&&(p.length?e.reject(n,d,c):e.resolve(n));a.isFunction(b)&&b.call(g,n,d,c)}function h(a){f(a.target,"error"===a.type)}function f(b,c){"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="!==b.src&&-1===a.inArray(b,k)&&(k.push(b),c?p.push(b):m.push(b),a.data(b,"imagesLoaded",{isBroken:c,src:b.src}),l&&e.notifyWith(a(b),[c,n,a(m),a(p)]),n.length===
k.length&&(setTimeout(d),n.unbind(".imagesLoaded",h)))}var g=this,e=a.isFunction(a.Deferred)?a.Deferred():0,l=a.isFunction(e.notify),n=g.find("img").add(g.filter("img")),k=[],m=[],p=[];a.isPlainObject(b)&&a.each(b,function(a,c){if("callback"===a)b=c;else if(e)e[a](c)});n.length?n.bind("load.imagesLoaded error.imagesLoaded",h).each(function(b,c){var d=c.src,e=a.data(c,"imagesLoaded");if(e&&e.src===d)f(c,e.isBroken);else if(c.complete&&c.naturalWidth!==x)f(c,0===c.naturalWidth||0===c.naturalHeight);
else if(c.readyState||c.complete)c.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",c.src=d}):d();return e?e.promise(g):g};var v=a.event,k,A={_:0},l=0,m,r;k=v.special.throttledresize={setup:function(){a(this).on("resize",k.handler)},teardown:function(){a(this).off("resize",k.handler)},handler:function(b,d){var h=this,f=arguments;m=!0;r||(setInterval(function(){l++;if(l>k.threshold&&m||d)b.type="throttledresize",v.dispatch.apply(h,f),m=!1,l=0;9<l&&(a(A).stop(),r=!1,l=0)},
30),r=!0)},threshold:0}})(jQuery,window,document);